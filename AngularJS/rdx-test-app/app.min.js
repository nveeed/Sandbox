'use strict';

// Declare app level module which depends on views, and components
angular.module('myApp', [
    'ngRoute',
    'myApp.products',
    'myApp.categories'
]).
config(['$routeProvider', '$locationProvider', function($routeProvider,$locationProvider) {
    $routeProvider.
        when('/', {
            templateUrl: 'partials/products.html',
            controller: 'ProductsCtrl'
        }).
        otherwise({redirectTo: '/'});
    $locationProvider.html5Mode(true);
}]);

// @codekit-append "js/categories.js"
// @codekit-append "js/products.js"
angular.module('myApp.categories', [])
.controller('CategoriesCtrl', ['$scope','$http', function(scope,$http) {
    $("#loading-div").show();
    $http.get(rdxTestAppGlobalVars.baseUrl+"/api/soap.php?a=category.tree&f=null").then(function (response) {
        scope.categories = response.data.children[0].children;
        scope.activeCategory = scope.categories[0];

        $http.get(rdxTestAppGlobalVars.baseUrl+"/api/soap.php?a=category.assignedProducts&f="+scope.activeCategory.category_id).then(function (response) {
            scope.products = response.data;
            $("#loading-div").hide();
        });
    });
}]);
angular.module('myApp.products', ['ngRoute','ngSanitize'])
.config(['$routeProvider', function($routeProvider) {
    $routeProvider.when('/products', {
        templateUrl: 'partials/products.html',
        controller: 'ProductsCtrl'
    });
}])
.controller('ProductsCtrl', ['$scope','$http', function(scope,$http) {
    //$("#loading-div").show();
    //$http.get(rdxTestAppGlobalVars.baseUrl+"/api/soap.php?a=category.assignedProducts&f=11").then(function (response) {
    //    scope.products = response.data;
    //    $("#loading-div").hide();
    //});
    /*$http.get("http://localhost/_Sandbox_/AngularJS/rdx-test-app/api/get-request-token.php").then(function (response) {
        var token = response.data.oauth_token;
        var secret = response.data.oauth_token_secret;
        var query = "oauth_token="+token+"&oauth_token_secret="+secret;
        var url = "http://localhost/_Sandbox_/AngularJS/rdx-test-app/api/get-access-token.php?"+query;
        $http.get(url).then(function (response) {
            var token = response.data.oauth_token;
            var secret = response.data.oauth_token_secret;
            var query = "oauth_token="+token+"&oauth_token_secret="+secret;
            var url = "http://localhost/_Sandbox_/AngularJS/rdx-test-app/api/get-data.php?"+query;
            $http.get(url).then(function (response) {
                scope.products = response.data;
                $("#loading-div").hide();
            });
        });
    });*/

}]);
var rdxTestAppGlobalVars = {
    baseUrl: "http://localhost/_Sandbox_/AngularJS/rdx-test-app"
};