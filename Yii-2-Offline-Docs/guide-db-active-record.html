<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.yiiframework.com/doc-2.0/guide-db-active-record.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 May 2015 18:10:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="assets/c268c820/css/bootstrap.css" rel="stylesheet">
<link href="assets/420f52a4/style.css" rel="stylesheet">
<script src="assets/4d3f04b3/jquery.js"></script>
<script src="assets/c268c820/js/bootstrap.js"></script>
<script src="assets/7ba40f0b/jssearch.js"></script>    <title>The Definitive Guide to Yii 2.0</title>
</head>
<body>

<div class="wrap">
    <nav id="w282" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w282-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="index-2.html">The Definitive Guide to Yii 2.0</a></div><div id="w282-collapse" class="collapse navbar-collapse"><ul id="w283" class="navbar-nav nav"><li><a href="index-2.html">Class reference</a></li>
<li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">Extensions <b class="caret"></b></a><ul id="w284" class="dropdown-menu"><li><a href="ext-apidoc-index.html" tabindex="-1">apidoc</a></li>
<li><a href="ext-authclient-index.html" tabindex="-1">authclient</a></li>
<li><a href="ext-bootstrap-index.html" tabindex="-1">bootstrap</a></li>
<li><a href="ext-codeception-index.html" tabindex="-1">codeception</a></li>
<li><a href="ext-composer-index.html" tabindex="-1">composer</a></li>
<li><a href="ext-debug-index.html" tabindex="-1">debug</a></li>
<li><a href="ext-elasticsearch-index.html" tabindex="-1">elasticsearch</a></li>
<li><a href="ext-faker-index.html" tabindex="-1">faker</a></li>
<li><a href="ext-gii-index.html" tabindex="-1">gii</a></li>
<li><a href="ext-imagine-index.html" tabindex="-1">imagine</a></li>
<li><a href="ext-jui-index.html" tabindex="-1">jui</a></li>
<li><a href="ext-mongodb-index.html" tabindex="-1">mongodb</a></li>
<li><a href="ext-redis-index.html" tabindex="-1">redis</a></li>
<li><a href="ext-smarty-index.html" tabindex="-1">smarty</a></li>
<li><a href="ext-sphinx-index.html" tabindex="-1">sphinx</a></li>
<li><a href="ext-swiftmailer-index.html" tabindex="-1">swiftmailer</a></li>
<li><a href="ext-twig-index.html" tabindex="-1">twig</a></li></ul></li>
<li><a href="guide-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"><a class="list-group-item" href="#navigation-266" data-toggle="collapse" data-parent="#navigation">Introduction <b class="caret"></b></a><div id="navigation-266" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-intro-yii.html">About Yii</a>
<a class="list-group-item" href="guide-intro-upgrade-from-v1.html">Upgrading from Version 1.1</a></div>
<a class="list-group-item" href="#navigation-267" data-toggle="collapse" data-parent="#navigation">Getting Started <b class="caret"></b></a><div id="navigation-267" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-start-installation.html">Installing Yii</a>
<a class="list-group-item" href="guide-start-workflow.html">Running Applications</a>
<a class="list-group-item" href="guide-start-hello.html">Saying Hello</a>
<a class="list-group-item" href="guide-start-forms.html">Working with Forms</a>
<a class="list-group-item" href="guide-start-databases.html">Working with Databases</a>
<a class="list-group-item" href="guide-start-gii.html">Generating Code with Gii</a>
<a class="list-group-item" href="guide-start-looking-ahead.html">Looking Ahead</a></div>
<a class="list-group-item" href="#navigation-268" data-toggle="collapse" data-parent="#navigation">Application Structure <b class="caret"></b></a><div id="navigation-268" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-structure-overview.html">Overview</a>
<a class="list-group-item" href="guide-structure-entry-scripts.html">Entry Scripts</a>
<a class="list-group-item" href="guide-structure-applications.html">Applications</a>
<a class="list-group-item" href="guide-structure-application-components.html">Application Components</a>
<a class="list-group-item" href="guide-structure-controllers.html">Controllers</a>
<a class="list-group-item" href="guide-structure-models.html">Models</a>
<a class="list-group-item" href="guide-structure-views.html">Views</a>
<a class="list-group-item" href="guide-structure-modules.html">Modules</a>
<a class="list-group-item" href="guide-structure-filters.html">Filters</a>
<a class="list-group-item" href="guide-structure-widgets.html">Widgets</a>
<a class="list-group-item" href="guide-structure-assets.html">Assets</a>
<a class="list-group-item" href="guide-structure-extensions.html">Extensions</a></div>
<a class="list-group-item" href="#navigation-269" data-toggle="collapse" data-parent="#navigation">Handling Requests <b class="caret"></b></a><div id="navigation-269" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-runtime-overview.html">Overview</a>
<a class="list-group-item" href="guide-runtime-bootstrapping.html">Bootstrapping</a>
<a class="list-group-item" href="guide-runtime-routing.html">Routing and URL Creation</a>
<a class="list-group-item" href="guide-runtime-requests.html">Requests</a>
<a class="list-group-item" href="guide-runtime-responses.html">Responses</a>
<a class="list-group-item" href="guide-runtime-sessions-cookies.html">Sessions and Cookies</a>
<a class="list-group-item" href="guide-runtime-handling-errors.html">Handling Errors</a>
<a class="list-group-item" href="guide-runtime-logging.html">Logging</a></div>
<a class="list-group-item" href="#navigation-270" data-toggle="collapse" data-parent="#navigation">Key Concepts <b class="caret"></b></a><div id="navigation-270" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-concept-components.html">Components</a>
<a class="list-group-item" href="guide-concept-properties.html">Properties</a>
<a class="list-group-item" href="guide-concept-events.html">Events</a>
<a class="list-group-item" href="guide-concept-behaviors.html">Behaviors</a>
<a class="list-group-item" href="guide-concept-configurations.html">Configurations</a>
<a class="list-group-item" href="guide-concept-aliases.html">Aliases</a>
<a class="list-group-item" href="guide-concept-autoloading.html">Class Autoloading</a>
<a class="list-group-item" href="guide-concept-service-locator.html">Service Locator</a>
<a class="list-group-item" href="guide-concept-di-container.html">Dependency Injection Container</a></div>
<a class="list-group-item active" href="#navigation-271" data-toggle="collapse" data-parent="#navigation">Working with Databases <b class="caret"></b></a><div id="navigation-271" class="submenu panel-collapse collapse in"><a class="list-group-item" href="guide-db-dao.html">Data Access Objects</a>
<a class="list-group-item" href="guide-db-query-builder.html">Query Builder</a>
<a class="list-group-item active" href="guide-db-active-record.html">Active Record</a>
<a class="list-group-item" href="guide-db-migrations.html">Migrations</a>
<a class="list-group-item" href="guide-db-sphinx.html">Sphinx</a>
<a class="list-group-item" href="guide-db-redis.html">Redis</a>
<a class="list-group-item" href="guide-db-mongodb.html">MongoDB</a>
<a class="list-group-item" href="guide-db-elasticsearch.html">ElasticSearch</a></div>
<a class="list-group-item" href="#navigation-272" data-toggle="collapse" data-parent="#navigation">Getting Data from Users <b class="caret"></b></a><div id="navigation-272" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-input-forms.html">Creating Forms</a>
<a class="list-group-item" href="guide-input-validation.html">Validating Input</a>
<a class="list-group-item" href="guide-input-file-upload.html">Uploading Files</a>
<a class="list-group-item" href="guide-input-tabular-input.html">Collecting tabular input</a>
<a class="list-group-item" href="guide-input-multiple-models.html">Getting Data for Multiple Models</a></div>
<a class="list-group-item" href="#navigation-273" data-toggle="collapse" data-parent="#navigation">Displaying Data <b class="caret"></b></a><div id="navigation-273" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-output-formatter.html">Data Formatting</a>
<a class="list-group-item" href="guide-output-pagination.html">Pagination</a>
<a class="list-group-item" href="guide-output-sorting.html">Sorting</a>
<a class="list-group-item" href="guide-output-data-providers.html">Data Providers</a>
<a class="list-group-item" href="guide-output-data-widgets.html">Data Widgets</a>
<a class="list-group-item" href="guide-output-client-scripts.html">Working with Client Scripts</a>
<a class="list-group-item" href="guide-output-theming.html">Theming</a></div>
<a class="list-group-item" href="#navigation-274" data-toggle="collapse" data-parent="#navigation">Security <b class="caret"></b></a><div id="navigation-274" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-security-authentication.html">Authentication</a>
<a class="list-group-item" href="guide-security-authorization.html">Authorization</a>
<a class="list-group-item" href="guide-security-passwords.html">Working with Passwords</a>
<a class="list-group-item" href="guide-security-auth-clients.html">Auth Clients</a>
<a class="list-group-item" href="guide-security-best-practices.html">Best Practices</a></div>
<a class="list-group-item" href="#navigation-275" data-toggle="collapse" data-parent="#navigation">Caching <b class="caret"></b></a><div id="navigation-275" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-caching-overview.html">Overview</a>
<a class="list-group-item" href="guide-caching-data.html">Data Caching</a>
<a class="list-group-item" href="guide-caching-fragment.html">Fragment Caching</a>
<a class="list-group-item" href="guide-caching-page.html">Page Caching</a>
<a class="list-group-item" href="guide-caching-http.html">HTTP Caching</a></div>
<a class="list-group-item" href="#navigation-276" data-toggle="collapse" data-parent="#navigation">RESTful Web Services <b class="caret"></b></a><div id="navigation-276" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-rest-quick-start.html">Quick Start</a>
<a class="list-group-item" href="guide-rest-resources.html">Resources</a>
<a class="list-group-item" href="guide-rest-controllers.html">Controllers</a>
<a class="list-group-item" href="guide-rest-routing.html">Routing</a>
<a class="list-group-item" href="guide-rest-response-formatting.html">Response Formatting</a>
<a class="list-group-item" href="guide-rest-authentication.html">Authentication</a>
<a class="list-group-item" href="guide-rest-rate-limiting.html">Rate Limiting</a>
<a class="list-group-item" href="guide-rest-versioning.html">Versioning</a>
<a class="list-group-item" href="guide-rest-error-handling.html">Error Handling</a></div>
<a class="list-group-item" href="#navigation-277" data-toggle="collapse" data-parent="#navigation">Development Tools <b class="caret"></b></a><div id="navigation-277" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-tool-debugger.html">Debug Toolbar and Debugger</a>
<a class="list-group-item" href="guide-tool-gii.html">Generating Code using Gii</a>
<a class="list-group-item" href="guide-tool-api-doc.html">Generating API Documentation</a></div>
<a class="list-group-item" href="#navigation-278" data-toggle="collapse" data-parent="#navigation">Testing <b class="caret"></b></a><div id="navigation-278" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-test-overview.html">Overview</a>
<a class="list-group-item" href="guide-test-environment-setup.html">Testing environment setup</a>
<a class="list-group-item" href="guide-test-unit.html">Unit Tests</a>
<a class="list-group-item" href="guide-test-functional.html">Functional Tests</a>
<a class="list-group-item" href="guide-test-acceptance.html">Acceptance Tests</a>
<a class="list-group-item" href="guide-test-fixtures.html">Fixtures</a></div>
<a class="list-group-item" href="#navigation-279" data-toggle="collapse" data-parent="#navigation">Special Topics <b class="caret"></b></a><div id="navigation-279" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-tutorial-advanced-app.html">Advanced Application Template</a>
<a class="list-group-item" href="guide-tutorial-start-from-scratch.html">Building Application from Scratch</a>
<a class="list-group-item" href="guide-tutorial-console.html">Console Commands</a>
<a class="list-group-item" href="guide-tutorial-core-validators.html">Core Validators</a>
<a class="list-group-item" href="guide-tutorial-i18n.html">Internationalization</a>
<a class="list-group-item" href="guide-tutorial-mailing.html">Mailing</a>
<a class="list-group-item" href="guide-tutorial-performance-tuning.html">Performance Tuning</a>
<a class="list-group-item" href="guide-tutorial-shared-hosting.html">Shared Hosting Environment</a>
<a class="list-group-item" href="guide-tutorial-template-engines.html">Template Engines</a>
<a class="list-group-item" href="guide-tutorial-yii-integration.html">Working with Third-Party Code</a></div>
<a class="list-group-item" href="#navigation-280" data-toggle="collapse" data-parent="#navigation">Widgets <b class="caret"></b></a><div id="navigation-280" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-widget-bootstrap.html">Bootstrap Widgets</a>
<a class="list-group-item" href="guide-widget-jui.html">jQuery UI Widgets</a></div>
<a class="list-group-item" href="#navigation-281" data-toggle="collapse" data-parent="#navigation">Helpers <b class="caret"></b></a><div id="navigation-281" class="submenu panel-collapse collapse"><a class="list-group-item" href="guide-helper-overview.html">Overview</a>
<a class="list-group-item" href="guide-helper-array.html">ArrayHelper</a>
<a class="list-group-item" href="guide-helper-html.html">Html</a>
<a class="list-group-item" href="guide-helper-url.html">Url</a></div></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <div class="fixlink"><a href="https://github.com/yiisoft/yii2/edit/master/docs/guide/db-active-record.md" class="h1" title="Found an error? Please help us fix it. Thanks!"><span class="glyphicon glyphicon-pencil"></a></div>
        <h1>Active Record <a href="#active-record" id="active-record" class="hashlink">&para;</a></h1><p><a href="http://en.wikipedia.org/wiki/Active_record_pattern">Active Record</a> provides an object-oriented interface
for accessing and manipulating data stored in databases. An Active Record class is associated with a database table,
an Active Record instance corresponds to a row of that table, and an <em>attribute</em> of an Active Record
instance represents the value of a particular column in that row. Instead of writing raw SQL statements,
you would access Active Record attributes and call Active Record methods to access and manipulate the data stored 
in database tables.</p>
<p>For example, assume <code>Customer</code> is an Active Record class which is associated with the <code>customer</code> table
and <code>name</code> is a column of the <code>customer</code> table. You can write the following code to insert a new
row into the <code>customer</code> table:</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Qiang'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();</span></code></pre>
<p>The above code is equivalent to using the following raw SQL statement for MySQL, which is less
intuitive, more error prone, and may even have compatibility problems if you are using a different kind of database:</p>
<pre><code class="language-php"><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">(</span><span style="color: #DD0000">'INSERT&nbsp;INTO&nbsp;`customer`&nbsp;(`name`)&nbsp;VALUES&nbsp;(:name)'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">':name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Qiang'</span><span style="color: #007700">,<br />])-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();</span></code></pre>
<p>Yii provides the Active Record support for the following relational databases:</p>
<ul>
<li>MySQL 4.1 or later: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>PostgreSQL 7.3 or later: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>SQLite 2 and 3: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>Microsoft SQL Server 2008 or later: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>Oracle: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a></li>
<li>CUBRID 9.3 or later: via <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a> (Note that due to a <a href="http://jira.cubrid.org/browse/APIS-658">bug</a> in
the cubrid PDO extension, quoting of values will not work, so you need CUBRID 9.3 as the client as well as the server)</li>
<li>Sphinx: via <a href="yii-sphinx-activerecord.html">yii\sphinx\ActiveRecord</a>, requires the <code>yii2-sphinx</code> extension</li>
<li>ElasticSearch: via <a href="yii-elasticsearch-activerecord.html">yii\elasticsearch\ActiveRecord</a>, requires the <code>yii2-elasticsearch</code> extension</li>
</ul>
<p>Additionally, Yii also supports using Active Record with the following NoSQL databases:</p>
<ul>
<li>Redis 2.6.12 or later: via <a href="yii-redis-activerecord.html">yii\redis\ActiveRecord</a>, requires the <code>yii2-redis</code> extension</li>
<li>MongoDB 1.3.0 or later: via <a href="yii-mongodb-activerecord.html">yii\mongodb\ActiveRecord</a>, requires the <code>yii2-mongodb</code> extension</li>
</ul>
<p>In this tutorial, we will mainly describe the usage of Active Record for relational databases.
However, most content described here are also applicable to Active Record for NoSQL databases.</p>
<h2>Declaring Active Record Classes <span id="declaring-ar-classes"></span> <a href="#declaring-active-record-classes" id="declaring-active-record-classes" class="hashlink">&para;</a></h2><p>To get started, declare an Active Record class by extending <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a>. Because each Active Record
class is associated with a database table, in this class you should override the <a href="yii-db-activerecord.html#tableName()-detail">tableName()</a>
method to specify which table the class is associated with.</p>
<p>In the following example, we declare an Active Record class named <code>Customer</code> for the <code>customer</code> database table.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">STATUS_INACTIVE&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span><span style="color: #0000BB">STATUS_ACTIVE&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@return&nbsp;string&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;table&nbsp;associated&nbsp;with&nbsp;this&nbsp;ActiveRecord&nbsp;class.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Active Record instances are considered as <a href="guide-structure-models.html">models</a>. For this reason, we usually put Active Record
classes under the <code>app\models</code> namespace (or other namespaces for keeping model classes). </p>
<p>Because <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a> extends from <a href="yii-base-model.html">yii\base\Model</a>, it inherits <em>all</em> <a href="guide-structure-models.html">model</a> features,
such as attributes, validation rules, data serialization, etc.</p>
<h2>Connecting to Databases <span id="db-connection"></span> <a href="#connecting-to-databases" id="connecting-to-databases" class="hashlink">&para;</a></h2><p>By default, Active Record uses the <code>db</code> <a href="guide-structure-application-components.html">application component</a> 
as the <a href="yii-db-connection.html">DB connection</a> to access and manipulate the database data. As explained in 
<a href="guide-db-dao.html">Database Access Objects</a>, you can configure the <code>db</code> component in the application configuration like shown
below,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'components'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'db'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\db\Connection'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'dsn'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'mysql:host=localhost;dbname=testdb'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'username'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'demo'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'demo'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />];</span></code></pre>
<p>If you want to use a different database connection other than the <code>db</code> component, you should override 
the <a href="yii-db-activerecord.html#getDb()-detail">getDb()</a> method:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">getDb</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;use&nbsp;the&nbsp;"db2"&nbsp;application&nbsp;component<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;\</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db2</span><span style="color: #007700">;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<h2>Querying Data <span id="querying-data"></span> <a href="#querying-data" id="querying-data" class="hashlink">&para;</a></h2><p>After declaring an Active Record class, you can use it to query data from the corresponding database table.
The process usually takes the following three steps:</p>
<ol>
<li>Create a new query object by calling the <a href="yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a> method;</li>
<li>Build the query object by calling <a href="guide-db-query-builder.html#building-queries">query building methods</a>;</li>
<li>Call a <a href="guide-db-query-builder.html#query-methods">query method</a> to retrieve data in terms ofActive Record instances.</li>
</ol>
<p>As you can see, this is very similar to the procedure with <a href="guide-db-query-builder.html">query builder</a>. The only difference
is that instead of using the <code>new</code> operator to create a query object, you call <a href="yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a>
to return a new query object which is of class <a href="yii-db-activequery.html">yii\db\ActiveQuery</a>.</p>
<p>Below are some examples showing how to use Active Query to query data:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;return&nbsp;a&nbsp;single&nbsp;customer&nbsp;whose&nbsp;ID&nbsp;is&nbsp;123<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">123</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">one</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;return&nbsp;all&nbsp;active&nbsp;customers&nbsp;and&nbsp;order&nbsp;them&nbsp;by&nbsp;their&nbsp;IDs<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`status`&nbsp;=&nbsp;1&nbsp;ORDER&nbsp;BY&nbsp;`id`<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;return&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;customers<br />//&nbsp;SELECT&nbsp;COUNT(*)&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`status`&nbsp;=&nbsp;1<br /></span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;return&nbsp;all&nbsp;active&nbsp;customers&nbsp;in&nbsp;an&nbsp;array&nbsp;indexed&nbsp;by&nbsp;customer&nbsp;IDs<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">indexBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>In the above, <code>$customer</code> is a <code>Customer</code> object while <code>$customers</code> is an array of <code>Customer</code> objects. They are
all populated with the data retrieved from the <code>customer</code> table.</p>
<blockquote><p>Info: Because <a href="yii-db-activequery.html">yii\db\ActiveQuery</a> extends from <a href="yii-db-query.html">yii\db\Query</a>, you can use <em>all</em> query building methods and
  query methods as described in the Section <a href="guide-db-query-builder.html">Query Builder</a>.</p>
</blockquote>
<p>Because it is a common task to query by primary key values or a set of column values, Yii provides two shortcut
methods for this purpose:</p>
<ul>
<li><a href="yii-db-baseactiverecord.html#findOne()-detail">yii\db\ActiveRecord::findOne()</a>: returns a single Active Record instance populated with the first row of the query result.</li>
<li><a href="yii-db-baseactiverecord.html#findAll()-detail">yii\db\ActiveRecord::findAll()</a>: returns an array of Active Record instances populated with <em>all</em> query result.</li>
</ul>
<p>Both methods can take one of the following parameter formats:</p>
<ul>
<li>a scalar value: the value is treated as the desired primary key value to be looked for. Yii will determine 
automatically which column is the primary key column by reading database schema information.</li>
<li>an array of scalar values: the array is treated as the desired primary key values to be looked for.</li>
<li>an associative array: the keys are column names and the values are the corresponding desired column values to 
be looked for. Please refer to <a href="guide-db-query-builder.html#hash-format">Hash Format</a> for more details.</li>
</ul>
<p>The following code shows how theses methods can be used:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;returns&nbsp;a&nbsp;single&nbsp;customer&nbsp;whose&nbsp;ID&nbsp;is&nbsp;123<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;returns&nbsp;customers&nbsp;whose&nbsp;ID&nbsp;is&nbsp;100,&nbsp;101,&nbsp;123&nbsp;or&nbsp;124<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;IN&nbsp;(100,&nbsp;101,&nbsp;123,&nbsp;124)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findAll</span><span style="color: #007700">([</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">101</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">123</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">124</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;returns&nbsp;an&nbsp;active&nbsp;customer&nbsp;whose&nbsp;ID&nbsp;is&nbsp;123<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123&nbsp;AND&nbsp;`status`&nbsp;=&nbsp;1<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">123</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">,<br />]);<br /><br /></span><span style="color: #FF8000">//&nbsp;returns&nbsp;all&nbsp;inactive&nbsp;customers<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`status`&nbsp;=&nbsp;0<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findAll</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_INACTIVE</span><span style="color: #007700">,<br />]);</span></code></pre>
<blockquote><p>Note: Neither <a href="yii-db-baseactiverecord.html#findOne()-detail">yii\db\ActiveRecord::findOne()</a> nor <a href="yii-db-activequery.html#one()-detail">yii\db\ActiveQuery::one()</a> will add <code>LIMIT 1</code> to 
  the generated SQL statement. If your query may return many rows of data, you should call <code>limit(1)</code> explicitly
  to improve the performance, e.g., <code>Customer::find()-&gt;limit(1)-&gt;one()</code>.</p>
</blockquote>
<p>Besides using query building methods, you can also write raw SQLs to query data and populate the results into
Active Record objects. You can do so by calling the <a href="yii-db-activerecord.html#findBySql()-detail">yii\db\ActiveRecord::findBySql()</a> method:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;returns&nbsp;all&nbsp;inactive&nbsp;customers<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'SELECT&nbsp;*&nbsp;FROM&nbsp;customer&nbsp;WHERE&nbsp;status=:status'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_INACTIVE</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>Do not call extra query building methods after calling <a href="yii-db-activerecord.html#findBySql()-detail">findBySql()</a> as they
will be ignored.</p>
<h2>Accessing Data <span id="accessing-data"></span> <a href="#accessing-data" id="accessing-data" class="hashlink">&para;</a></h2><p>As aforementioned, the data brought back from the database are populated into Active Record instances, and
each row of the query result corresponds to a single Active Record instance. You can access the column values
by accessing the attributes of the Active Record instances, for example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;"id"&nbsp;and&nbsp;"email"&nbsp;are&nbsp;the&nbsp;names&nbsp;of&nbsp;columns&nbsp;in&nbsp;the&nbsp;"customer"&nbsp;table<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email</span><span style="color: #007700">;</span></code></pre>
<blockquote><p>Note: The Active Record attributes are named after the associated table columns in a case-sensitive manner.
  Yii automatically defines an attribute in Active Record for every column of the associated table.
  You should NOT redeclare any of the attributes. </p>
</blockquote>
<p>Because Active Record attributes are named after table columns, you may find you are writing PHP code like
<code>$customer-&gt;first_name</code>, which uses underscores to separate words in attribute names if your table columns are
named in this way. If you are concerned about code style consistency, you should rename your table columns accordingly
(to use camelCase, for example.)</p>
<h3>Data Transformation <span id="data-transformation"></span> <a href="#data-transformation" id="data-transformation" class="hashlink">&para;</a></h3><p>It often happens that the data being entered and/or displayed are in a different format from the one used in
storing the data in a database. For example, in the database you are storing customers' birthdays as UNIX timestamps
(which is not a good design, though), while in most cases you would like to manipulate birthdays as strings in
the format of <code>'YYYY/MM/DD'</code>. To achieve this goal, you can define data transformation methods in the <code>Customer</code>
Active Record class like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getBirthdayText</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #DD0000">'Y/m/d'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">setBirthdayText</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">strtotime</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Now in your PHP code, instead of accessing <code>$customer-&gt;birthday</code>, you would access <code>$customer-&gt;birthdayText</code>, which
will allow you to input and display customer birthdays in the format of <code>'YYYY/MM/DD'</code>.</p>
<blockquote><p>Tip: the above shows an easy approach to achieve data transformation in general. For date values Yii provides a better
way using the <a href="guide-tutorial-core-validators.html#date">DateValidator</a> and a DatePicker widget, which is described in the
<a href="widget-jui.html#datepicker-date-input">JUI Widgets section</a>.</p>
</blockquote>
<h3>Retrieving Data in Arrays <span id="data-in-arrays"></span> <a href="#retrieving-data-in-arrays" id="retrieving-data-in-arrays" class="hashlink">&para;</a></h3><p>While retrieving data in terms of Active Record objects is convenient and flexible, it is not always desirable
when you have to bring back a large amount of data due to the big memory footprint. In this case, you can retrieve
data using PHP arrays by calling <a href="yii-db-activequerytrait.html#asArray()-detail">asArray()</a> before executing a query method:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;return&nbsp;all&nbsp;customers<br />//&nbsp;each&nbsp;customer&nbsp;is&nbsp;returned&nbsp;as&nbsp;an&nbsp;associative&nbsp;array<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">asArray</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<blockquote><p>Note: While this method saves memory and improves performance, it is closer to the lower DB abstraction layer
  and you will lose most of the Active Record features. A very important distinction lies in the data type of
  the column values. When you return data in Active Record instances, column values will be automatically typecast
  according to the actual column types; on the other hand when you return data in arrays, column values will be
  strings (since they are the result of PDO without any processing), regardless their actual column types.</p>
</blockquote>
<h3>Retrieving Data in Batches <span id="data-in-batches"></span> <a href="#retrieving-data-in-batches" id="retrieving-data-in-batches" class="hashlink">&para;</a></h3><p>In <a href="guide-db-query-builder.html">Query Builder</a>, we have explained that you may use <em>batch query</em> to minimize your memory
usage when querying a large amount of data from the database. You may use the same technique in Active Record. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;fetch&nbsp;10&nbsp;customers&nbsp;at&nbsp;a&nbsp;time<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">batch</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$customers&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;10&nbsp;or&nbsp;fewer&nbsp;Customer&nbsp;objects<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #FF8000">//&nbsp;fetch&nbsp;10&nbsp;customers&nbsp;at&nbsp;a&nbsp;time&nbsp;and&nbsp;iterate&nbsp;them&nbsp;one&nbsp;by&nbsp;one<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">)&nbsp;as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$customer&nbsp;is&nbsp;a&nbsp;Customer&nbsp;object<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #FF8000">//&nbsp;batch&nbsp;query&nbsp;with&nbsp;eager&nbsp;loading<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">each</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;$customer&nbsp;is&nbsp;a&nbsp;Customer&nbsp;object<br /></span><span style="color: #007700">}</span></code></pre>
<h2>Saving Data <span id="inserting-updating-data"></span> <a href="#saving-data" id="saving-data" class="hashlink">&para;</a></h2><p>Using Active Record, you can easily save data to database by taking the following steps:</p>
<ol>
<li>Prepare an Active Record instance</li>
<li>Assign new values to Active Record attributes</li>
<li>Call <a href="yii-db-baseactiverecord.html#save()-detail">yii\db\ActiveRecord::save()</a> to save the data into database.</li>
</ol>
<p>For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;insert&nbsp;a&nbsp;new&nbsp;row&nbsp;of&nbsp;data<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'James'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'james@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;update&nbsp;an&nbsp;existing&nbsp;row&nbsp;of&nbsp;data<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'james@newexample.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();</span></code></pre>
<p>The <a href="yii-db-baseactiverecord.html#save()-detail">save()</a> method can either insert or update a row of data, depending on the state
of the Active Record instance. If the instance is newly created via the <code>new</code> operator, calling 
<a href="yii-db-baseactiverecord.html#save()-detail">save()</a> will cause insertion of a new row; If the instance is the result of a query method,
calling <a href="yii-db-baseactiverecord.html#save()-detail">save()</a> will update the row associated with the instance. </p>
<p>You can differentiate the two states of an Active Record instance by checking its 
<a href="yii-db-baseactiverecord.html#$isNewRecord-detail">isNewRecord</a> property value. This property is also used by 
<a href="yii-db-baseactiverecord.html#save()-detail">save()</a> internally as follows:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">save</span><span style="color: #007700">(</span><span style="color: #0000BB">$runValidation&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributeNames&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getIsNewRecord</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(</span><span style="color: #0000BB">$runValidation</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributeNames</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">update</span><span style="color: #007700">(</span><span style="color: #0000BB">$runValidation</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attributeNames</span><span style="color: #007700">)&nbsp;!==&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<blockquote><p>Tip: You can call <a href="yii-db-activerecord.html#insert()-detail">insert()</a> or <a href="yii-db-activerecord.html#update()-detail">update()</a>
  directly to insert or update a row.</p>
</blockquote>
<h3>Data Validation <span id="data-validation"></span> <a href="#data-validation" id="data-validation" class="hashlink">&para;</a></h3><p>Because <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a> extends from <a href="yii-base-model.html">yii\base\Model</a>, it shares the same <a href="guide-input-validation.html">data validation</a> feature.
You can declare validation rules by overriding the <a href="yii-base-model.html#rules()-detail">rules()</a> method and perform 
data validation by calling the <a href="yii-base-model.html#validate()-detail">validate()</a> method.</p>
<p>When you call <a href="yii-db-baseactiverecord.html#save()-detail">save()</a>, by default it will call <a href="yii-base-model.html#validate()-detail">validate()</a>
automatically. Only when the validation passes, will it actually save the data; otherwise it will simply return false,
and you can check the <a href="yii-base-model.html#$errors-detail">errors</a> property to retrieve the validation error messages.  </p>
<blockquote><p>Tip: If you are certain that your data do not need validation (e.g., the data comes from trustable sources),
  you can call <code>save(false)</code> to skip the validation.</p>
</blockquote>
<h3>Massive Assignment <span id="massive-assignment"></span> <a href="#massive-assignment" id="massive-assignment" class="hashlink">&para;</a></h3><p>Like normal <a href="guide-structure-models.html">models</a>, Active Record instances also enjoy the <a href="guide-structure-models.html#massive-assignment">massive assignment feature</a>.
Using this feature, you can assign values to multiple attributes of an Active Record instance in a single PHP statement,
like shown below. Do remember that only <a href="guide-structure-models.html#safe-attributes">safe attributes</a> can be massively assigned, though.</p>
<pre><code class="language-php"><span style="color: #0000BB">$values&nbsp;</span><span style="color: #007700">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'James'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'james@example.com'</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">attributes&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$values</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();</span></code></pre>
<h3>Updating Counters <span id="updating-counters"></span> <a href="#updating-counters" id="updating-counters" class="hashlink">&para;</a></h3><p>It is a common task to increment or decrement a column in a database table. We call such columns as counter columns.
You can use <a href="yii-db-baseactiverecord.html#updateCounters()-detail">updateCounters()</a> to update one or multiple counter columns.
For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$post&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Post</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;UPDATE&nbsp;`post`&nbsp;SET&nbsp;`view_count`&nbsp;=&nbsp;`view_count`&nbsp;+&nbsp;1&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;100<br /></span><span style="color: #0000BB">$post</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">updateCounters</span><span style="color: #007700">([</span><span style="color: #DD0000">'view_count'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]);</span></code></pre>
<blockquote><p>Note: If you use <a href="yii-db-baseactiverecord.html#save()-detail">yii\db\ActiveRecord::save()</a> to update a counter column, you may end up with inaccurate result,
  because it is likely the same counter is being saved by multiple requests which read and write the same counter value.</p>
</blockquote>
<h3>Dirty Attributes <span id="dirty-attributes"></span> <a href="#dirty-attributes" id="dirty-attributes" class="hashlink">&para;</a></h3><p>When you call <a href="yii-db-baseactiverecord.html#save()-detail">save()</a> to save an Active Record instance, only <em>dirty attributes</em>
are being saved. An attribute is considered <em>dirty</em> if its value has been modified since it was loaded from DB or
saved to DB most recently. Note that data validation will be performed regardless if the Active Record 
instance has dirty attributes or not.</p>
<p>Active Record automatically maintains the list of dirty attributes. It does so by maintaining an older version of
the attribute values and comparing them with the latest one. You can call <a href="yii-db-baseactiverecord.html#getDirtyAttributes()-detail">yii\db\ActiveRecord::getDirtyAttributes()</a> 
to get the attributes that are currently dirty. You can also call <a href="yii-db-baseactiverecord.html#markAttributeDirty()-detail">yii\db\ActiveRecord::markAttributeDirty()</a> 
to explicitly mark an attribute as dirty.</p>
<p>If you are interested in the attribute values prior to their most recent modification, you may call 
<a href="yii-db-baseactiverecord.html#getOldAttributes()-detail">getOldAttributes()</a> or <a href="yii-db-baseactiverecord.html#getOldAttribute()-detail">getOldAttribute()</a>.</p>
<h3>Default Attribute Values <span id="default-attribute-values"></span> <a href="#default-attribute-values" id="default-attribute-values" class="hashlink">&para;</a></h3><p>Some of your table columns may have default values defined in the database. Sometimes, you may want to pre-populate your
Web form for an Active Record instance with these default values. To avoid writing the same default values again,
you can call <a href="yii-db-activerecord.html#loadDefaultValues()-detail">loadDefaultValues()</a> to populate the DB-defined default values
into the corresponding Active Record attributes:</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">loadDefaultValues</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;$customer-&gt;xyz&nbsp;will&nbsp;be&nbsp;assigned&nbsp;the&nbsp;default&nbsp;value&nbsp;declared&nbsp;when&nbsp;defining&nbsp;the&nbsp;"xyz"&nbsp;column</span></code></pre>
<h3>Updating Multiple Rows <span id="updating-multiple-rows"></span> <a href="#updating-multiple-rows" id="updating-multiple-rows" class="hashlink">&para;</a></h3><p>The methods described above all work on individual Active Record instances, causing inserting or updating of individual
table rows. To update multiple rows simultaneously, you should call <a href="yii-db-activerecord.html#updateAll()-detail">updateAll()</a>, instead,
which is a static method.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;UPDATE&nbsp;`customer`&nbsp;SET&nbsp;`status`&nbsp;=&nbsp;1&nbsp;WHERE&nbsp;`email`&nbsp;LIKE&nbsp;`%@example.com`<br /></span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">updateAll</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">],&nbsp;[</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'email'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'@example.com'</span><span style="color: #007700">]);</span></code></pre>
<p>Similarly, you can call <a href="yii-db-activerecord.html#updateAllCounters()-detail">updateAllCounters()</a> to update counter columns of
multiple rows at the same time.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;UPDATE&nbsp;`customer`&nbsp;SET&nbsp;`age`&nbsp;=&nbsp;`age`&nbsp;+&nbsp;1<br /></span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">updateAllCounters</span><span style="color: #007700">([</span><span style="color: #DD0000">'age'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">]);</span></code></pre>
<h2>Deleting Data <span id="deleting-data"></span> <a href="#deleting-data" id="deleting-data" class="hashlink">&para;</a></h2><p>To delete a single row of data, first retrieve the Active Record instance corresponding to that row and then call
the <a href="yii-db-activerecord.html#delete()-detail">yii\db\ActiveRecord::delete()</a> method.</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">delete</span><span style="color: #007700">();</span></code></pre>
<p>You can call <a href="yii-db-activerecord.html#deleteAll()-detail">yii\db\ActiveRecord::deleteAll()</a> to delete multiple or all rows of data. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">deleteAll</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_INACTIVE</span><span style="color: #007700">]);</span></code></pre>
<blockquote><p>Note: Be very careful when calling <a href="yii-db-activerecord.html#deleteAll()-detail">deleteAll()</a> because it may totally
  erase all data from your table if you make a mistake in specifying the condition.</p>
</blockquote>
<h2>Active Record Life Cycles <span id="ar-life-cycles"></span> <a href="#active-record-life-cycles" id="active-record-life-cycles" class="hashlink">&para;</a></h2><p>It is important to understand the life cycles of Active Record when it is used for different purposes.
During each life cycle, a certain sequence of methods will be invoked, and you can override these methods
to get a chance to customize the life cycle. You can also respond to certain Active Record events triggered 
during a life cycle to inject your custom code. These events are especially useful when you are developing 
Active Record <a href="guide-concept-behaviors.html">behaviors</a> which need to customize Active Record life cycles.</p>
<p>In the following, we will summarize various Active Record life cycles and the methods/events that are involved
in the life cycles.</p>
<h3>New Instance Life Cycle <span id="new-instance-life-cycle"></span> <a href="#new-instance-life-cycle" id="new-instance-life-cycle" class="hashlink">&para;</a></h3><p>When creating a new Active Record instance via the <code>new</code> operator, the following life cycle will happen:</p>
<ol>
<li>class constructor;</li>
<li><a href="yii-db-baseactiverecord.html#init()-detail">init()</a>: triggers an <a href="yii-db-baseactiverecord.html#EVENT_INIT-detail">EVENT_INIT</a> event.</li>
</ol>
<h3>Querying Data Life Cycle <span id="querying-data-life-cycle"></span> <a href="#querying-data-life-cycle" id="querying-data-life-cycle" class="hashlink">&para;</a></h3><p>When querying data through one of the <a href="#querying-data">querying methods</a>, each newly populated Active Record will
undergo the following life cycle:</p>
<ol>
<li>class constructor.</li>
<li><a href="yii-db-baseactiverecord.html#init()-detail">init()</a>: triggers an <a href="yii-db-baseactiverecord.html#EVENT_INIT-detail">EVENT_INIT</a> event.</li>
<li><a href="yii-db-baseactiverecord.html#afterFind()-detail">afterFind()</a>: triggers an <a href="yii-db-baseactiverecord.html#EVENT_AFTER_FIND-detail">EVENT_AFTER_FIND</a> event.</li>
</ol>
<h3>Saving Data Life Cycle <span id="saving-data-life-cycle"></span> <a href="#saving-data-life-cycle" id="saving-data-life-cycle" class="hashlink">&para;</a></h3><p>When calling <a href="yii-db-baseactiverecord.html#save()-detail">save()</a> to insert or update an Active Record instance, the following
life cycle will happen:</p>
<ol>
<li><p>an <a href="yii-base-model.html#EVENT_BEFORE_VALIDATE-detail">EVENT_BEFORE_VALIDATE</a> event. If the method returns false
or <a href="yii-base-modelevent.html#$isValid-detail">yii\base\ModelEvent::$isValid</a> is false, the rest of the steps will be skipped.</p>
</li>
<li>Performs data validation. If data validation fails, the steps after Step 3 will be skipped. </li>
<li><p>an <a href="yii-base-model.html#EVENT_AFTER_VALIDATE-detail">EVENT_AFTER_VALIDATE</a> event.</p>
</li>
<li><p>an <a href="yii-db-baseactiverecord.html#EVENT_BEFORE_INSERT-detail">EVENT_BEFORE_INSERT</a> 
or <a href="yii-db-baseactiverecord.html#EVENT_BEFORE_UPDATE-detail">EVENT_BEFORE_UPDATE</a> event. If the method returns false
or <a href="yii-base-modelevent.html#$isValid-detail">yii\base\ModelEvent::$isValid</a> is false, the rest of the steps will be skipped.</p>
</li>
<li>Performs the actual data insertion or updating;</li>
<li><p>an <a href="yii-db-baseactiverecord.html#EVENT_AFTER_INSERT-detail">EVENT_AFTER_INSERT</a> 
or <a href="yii-db-baseactiverecord.html#EVENT_AFTER_UPDATE-detail">EVENT_AFTER_UPDATE</a> event.</p>
</li>
</ol>
<h3>Deleting Data Life Cycle <span id="deleting-data-life-cycle"></span> <a href="#deleting-data-life-cycle" id="deleting-data-life-cycle" class="hashlink">&para;</a></h3><p>When calling <a href="yii-db-activerecord.html#delete()-detail">delete()</a> to delete an Active Record instance, the following
life cycle will happen:</p>
<ol>
<li><p>an <a href="yii-db-baseactiverecord.html#EVENT_BEFORE_DELETE-detail">EVENT_BEFORE_DELETE</a> event. If the method returns false
or <a href="yii-base-modelevent.html#$isValid-detail">yii\base\ModelEvent::$isValid</a> is false, the rest of the steps will be skipped.</p>
</li>
<li>perform the actual data deletion</li>
<li><p>an <a href="yii-db-baseactiverecord.html#EVENT_AFTER_DELETE-detail">EVENT_AFTER_DELETE</a> event.</p>
</li>
</ol>
<blockquote><p>Note: Calling any of the following methods will NOT initiate any of the above life cycles:</p>
<ul>
<li><a href="yii-db-activerecord.html#updateAll()-detail">yii\db\ActiveRecord::updateAll()</a> </li>
<li><a href="yii-db-activerecord.html#deleteAll()-detail">yii\db\ActiveRecord::deleteAll()</a></li>
<li><a href="yii-db-baseactiverecord.html#updateCounters()-detail">yii\db\ActiveRecord::updateCounters()</a> </li>
<li><a href="yii-db-activerecord.html#updateAllCounters()-detail">yii\db\ActiveRecord::updateAllCounters()</a> </li>
</ul>
</blockquote>
<h2>Working with Transactions <span id="transactional-operations"></span> <a href="#working-with-transactions" id="working-with-transactions" class="hashlink">&para;</a></h2><p>There are two ways of using <a href="guide-db-dao.html#performing-transactions">transactions</a> while working with Active Record. </p>
<p>The first way is to explicitly enclose Active Record method calls in a transactional block, like shown below,</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">getDb</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">transaction</span><span style="color: #007700">(function(</span><span style="color: #0000BB">$db</span><span style="color: #007700">)&nbsp;use&nbsp;(</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...other&nbsp;DB&nbsp;operations...<br /></span><span style="color: #007700">});<br /><br /></span><span style="color: #FF8000">//&nbsp;or&nbsp;alternatively<br /><br /></span><span style="color: #0000BB">$transaction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">getDb</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">beginTransaction</span><span style="color: #007700">();<br />try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...other&nbsp;DB&nbsp;operations...<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commit</span><span style="color: #007700">();<br />}&nbsp;catch(\</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$transaction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rollBack</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;</span><span style="color: #0000BB">$e</span><span style="color: #007700">;<br />}</span></code></pre>
<p>The second way is to list the DB operations that require transactional support in the <a href="yii-db-activerecord.html#transactions()-detail">yii\db\ActiveRecord::transactions()</a>
method. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">transactions</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'admin'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_INSERT</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'api'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_INSERT&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_UPDATE&nbsp;</span><span style="color: #007700">|&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">OP_DELETE</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;the&nbsp;above&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;following:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;'api'&nbsp;=&gt;&nbsp;self::OP_ALL,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>The <a href="yii-db-activerecord.html#transactions()-detail">yii\db\ActiveRecord::transactions()</a> method should return an array whose keys are <a href="guide-structure-models.html#scenarios">scenario</a>
names and values the corresponding operations that should be enclosed within transactions. You should use the following
constants to refer to different DB operations:</p>
<ul>
<li><a href="yii-db-activerecord.html#OP_INSERT-detail">OP_INSERT</a>: insertion operation performed by <a href="yii-db-activerecord.html#insert()-detail">insert()</a>;</li>
<li><a href="yii-db-activerecord.html#OP_UPDATE-detail">OP_UPDATE</a>: update operation performed by <a href="yii-db-activerecord.html#update()-detail">update()</a>;</li>
<li><a href="yii-db-activerecord.html#OP_DELETE-detail">OP_DELETE</a>: deletion operation performed by <a href="yii-db-activerecord.html#delete()-detail">delete()</a>.</li>
</ul>
<p>Use <code>|</code> operators to concatenate the above constants to indicate multiple operations. You may also use the shortcut
constant <a href="yii-db-activerecord.html#OP_ALL-detail">OP_ALL</a> to refer to all three operations above.</p>
<h2>Optimistic Locks <span id="optimistic-locks"></span> <a href="#optimistic-locks" id="optimistic-locks" class="hashlink">&para;</a></h2><p>Optimistic locking is a way to prevent conflicts that may occur when a single row of data is being
updated by multiple users. For example, both user A and user B are editing the same wiki article
at the same time. After user A saves his edits, user B clicks on the "Save" button in an attempt to
save his edits as well. Because user B was actually working on an outdated version of the article,
it would be desirable to have a way to prevent him from saving the article and show him some hint message.</p>
<p>Optimistic locking solves the above problem by using a column to record the version number of each row.
When a row is being saved with an outdated version number, a <a href="yii-db-staleobjectexception.html">yii\db\StaleObjectException</a> exception
will be thrown, which prevents the row from being saved. Optimistic locking is only supported when you
update or delete an existing row of data using <a href="yii-db-activerecord.html#update()-detail">yii\db\ActiveRecord::update()</a> or <a href="yii-db-activerecord.html#delete()-detail">yii\db\ActiveRecord::delete()</a>,
respectively.</p>
<p>To use optimistic locking,</p>
<ol>
<li>Create a column in the DB table associated with the Active Record class to store the version number of each row.
The column should be of big integer type (in MySQL it would be <code>BIGINT DEFAULT 0</code>).</li>
<li>Override the <a href="yii-db-baseactiverecord.html#optimisticLock()-detail">yii\db\ActiveRecord::optimisticLock()</a> method to return the name of this column.</li>
<li>In the Web form that takes user inputs, add a hidden field to store the current version number of the row being updated.</li>
<li>In the controller action that updates the row using Active Record, try and catch the <a href="yii-db-staleobjectexception.html">yii\db\StaleObjectException</a>
exception. Implement necessary business logic (e.g. merging the changes, prompting staled data) to resolve the conflict.</li>
</ol>
<p>For example, assume the version column is named as <code>version</code>. You can implement optimistic locking with the code like
the following.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;------&nbsp;view&nbsp;code&nbsp;-------<br /><br /></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Html</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;...other&nbsp;input&nbsp;fields<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">Html</span><span style="color: #007700">::</span><span style="color: #0000BB">activeHiddenField</span><span style="color: #007700">(</span><span style="color: #0000BB">$model</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'version'</span><span style="color: #007700">);<br /><br /><br /></span><span style="color: #FF8000">//&nbsp;------&nbsp;controller&nbsp;code&nbsp;-------<br /><br /></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">StaleObjectException</span><span style="color: #007700">;<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionUpdate</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">findModel</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">request</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">post</span><span style="color: #007700">())&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">redirect</span><span style="color: #007700">([</span><span style="color: #DD0000">'view'</span><span style="color: #007700">,&nbsp;&lt;?=&nbsp;</span><span style="color: #0000BB">$urlParams&nbsp;?&gt;</span>]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$this-&gt;render('update',&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'model'&nbsp;=&gt;&nbsp;$model,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(StaleObjectException&nbsp;$e)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logic&nbsp;to&nbsp;resolve&nbsp;the&nbsp;conflict<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /></code></pre>
<h2>Working with Relational Data <span id="relational-data"></span> <a href="#working-with-relational-data" id="working-with-relational-data" class="hashlink">&para;</a></h2><p>Besides working with individual database tables, Active Record is also capable of bringing together related data,
making them readily accessible through the primary data. For example, the customer data is related with the order
data because one customer may have placed one or multiple orders. With appropriate declaration of this relation,
you may be able to access a customer's order information using the expression <code>$customer-&gt;orders</code> which gives
back the customer's order information in terms of an array of <code>Order</code> Active Record instances.</p>
<h3>Declaring Relations <span id="declaring-relations"></span> <a href="#declaring-relations" id="declaring-relations" class="hashlink">&para;</a></h3><p>To work with relational data using Active Record, you first need to declare relations in Active Record classes.
The task is as simple as declaring a <em>relation method</em> for every interested relation, like the following,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCustomer</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>In the above code, we have declared an <code>orders</code> relation for the <code>Customer</code> class, and a <code>customer</code> relation
for the <code>Order</code> class. </p>
<p>Each relation method must be named as <code>getXyz</code>. We call <code>xyz</code> (the first letter is in lower case) the <em>relation name</em>.
Note that relation names are <em>case sensitive</em>.</p>
<p>While declaring a relation, you should specify the following information:</p>
<ul>
<li>the multiplicity of the relation: specified by calling either <a href="yii-db-baseactiverecord.html#hasMany()-detail">hasMany()</a>
or <a href="yii-db-baseactiverecord.html#hasOne()-detail">hasOne()</a>. In the above example you may easily read in the relation 
declarations that a customer has many orders while an order only has one customer.</li>
<li>the name of the related Active Record class: specified as the first parameter to 
either <a href="yii-db-baseactiverecord.html#hasMany()-detail">hasMany()</a> or <a href="yii-db-baseactiverecord.html#hasOne()-detail">hasOne()</a>.
A recommended practice is to call <code>Xyz::className()</code> to get the class name string so that you can receive
IDE auto-completion support as well as error detection at compiling stage. </li>
<li>the link between the two types of data: specifies the column(s) through which the two types of data are related.
The array values are the columns of the primary data (represented by the Active Record class that you are declaring
relations), while the array keys are the columns of the related data.</li>
</ul>
<h3>Accessing Relational Data <span id="accessing-relational-data"></span> <a href="#accessing-relational-data" id="accessing-relational-data" class="hashlink">&para;</a></h3><p>After declaring relations, you can access relational data through relation names. This is just like accessing
an object <a href="guide-concept-properties.html">property</a> defined by the relation method. For this reason, we call it <em>relation property</em>.
For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;=&nbsp;123<br />//&nbsp;$orders&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;Order&nbsp;objects<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;</span></code></pre>
<blockquote><p>Info: When you declare a relation named <code>xyz</code> via a getter method <code>getXyz()</code>, you will be able to access
  <code>xyz</code> like an object <a href="guide-concept-properties.html">property</a>. Note that the name is case sensitive.</p>
</blockquote>
<p>If a relation is declared with <a href="yii-db-baseactiverecord.html#hasMany()-detail">hasMany()</a>, accessing this relation property
will return an array of the related Active Record instances; if a relation is declared with 
<a href="yii-db-baseactiverecord.html#hasOne()-detail">hasOne()</a>, accessing the relation property will return the related
Active Record instance or null if no related data is found.</p>
<p>When you access a relation property for the first time, a SQL statement will be executed, like shown in the
above example. If the same property is accessed again, the previous result will be returned without re-executing
the SQL statement. To force re-executing the SQL statement, you should unset the relation property
first: <code>unset($customer-&gt;orders)</code>.</p>
<h3>Dynamic Relational Query <span id="dynamic-relational-query"></span> <a href="#dynamic-relational-query" id="dynamic-relational-query" class="hashlink">&para;</a></h3><p>Because a relation method returns an instance of <a href="yii-db-activequery.html">yii\db\ActiveQuery</a>, you can further build this query
using query building methods before performing DB query. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`subtotal`&nbsp;&gt;&nbsp;200&nbsp;ORDER&nbsp;BY&nbsp;`id`<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'&gt;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'subtotal'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">200</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>Sometimes you may even want to parameterize a relation declaration so that you can more easily perform
dynamic relational query. For example, you may declare a <code>bigOrders</code> relation as follows, </p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getBigOrders</span><span style="color: #007700">(</span><span style="color: #0000BB">$threshold&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'subtotal&nbsp;&gt;&nbsp;:threshold'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">':threshold'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$threshold</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">orderBy</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Then you will be able to perform the following relational queries:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`subtotal`&nbsp;&gt;&nbsp;200&nbsp;ORDER&nbsp;BY&nbsp;`id`<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getBigOrders</span><span style="color: #007700">(</span><span style="color: #0000BB">200</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`subtotal`&nbsp;&gt;&nbsp;100&nbsp;ORDER&nbsp;BY&nbsp;`id`<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bigOrders</span><span style="color: #007700">;</span></code></pre>
<blockquote><p>Note: While a relation method returns a <a href="yii-db-activequery.html">yii\db\ActiveQuery</a> instance, accessing a relation property will either
  return a <a href="yii-db-activerecord.html">yii\db\ActiveRecord</a> instance or an array of that. This is different from a normal object 
  <a href="guide-concept-properties.html">property</a> whose property value is of the same type as the defining getter method.</p>
</blockquote>
<p>Unlike accessing a relation property, each time you perform a dynamic relational query via a relation method, 
a SQL statement will be executed, even if the same dynamic relational query is performed before.</p>
<h3>Relations via a Junction Table <span id="junction-table"></span> <a href="#relations-via-a-junction-table" id="relations-via-a-junction-table" class="hashlink">&para;</a></h3><p>In database modelling, when the multiplicity between two related tables is many-to-many, 
a <a href="https://en.wikipedia.org/wiki/Junction_table">junction table</a> is usually introduced. For example, the <code>order</code>
table and the <code>item</code> table may be related via a junction table named <code>order_item</code>. One order will then correspond
to multiple order items, while one product item will also correspond to multiple order items.</p>
<p>When declaring such relations, you would call either <a href="yii-db-activerelationtrait.html#via()-detail">via()</a> or <a href="yii-db-activequery.html#viaTable()-detail">viaTable()</a>
to specify the junction table. The difference between <a href="yii-db-activerelationtrait.html#via()-detail">via()</a> and <a href="yii-db-activequery.html#viaTable()-detail">viaTable()</a>
is that the former specifies the junction table in terms of an existing relation name while the latter directly
the junction table. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Item</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'item_id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">viaTable</span><span style="color: #007700">(</span><span style="color: #DD0000">'order_item'</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">'order_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>or alternatively,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrderItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">OrderItem</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'order_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getItems</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Item</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'item_id'</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">via</span><span style="color: #007700">(</span><span style="color: #DD0000">'orderItems'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>The usage of relations declared with a junction table is the same as that of normal relations. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;100<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order_item`&nbsp;WHERE&nbsp;`order_id`&nbsp;=&nbsp;100<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`item`&nbsp;WHERE&nbsp;`item_id`&nbsp;IN&nbsp;(...)<br />//&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;Item&nbsp;objects<br /></span><span style="color: #0000BB">$items&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">items</span><span style="color: #007700">;</span></code></pre>
<h3>Lazy Loading and Eager Loading <span id="lazy-eager-loading"></span> <a href="#lazy-loading-and-eager-loading" id="lazy-loading-and-eager-loading" class="hashlink">&para;</a></h3><p>In <a href="#accessing-relational-data">Accessing Relational Data</a>, we explained that you can access a relation property
of an Active Record instance like accessing a normal object property. A SQL statement will be executed only when
you access the relation property the first time. We call such relational data accessing method <em>lazy loading</em>.
For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;no&nbsp;SQL&nbsp;executed<br /></span><span style="color: #0000BB">$orders2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;</span></code></pre>
<p>Lazy loading is very convenient to use. However, it may suffer from a performance issue when you need to access
the same relation property of multiple Active Record instances. Consider the following code example. How many 
SQL statements will be executed?</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;LIMIT&nbsp;100<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;=&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br />}</span></code></pre>
<p>As you can see from the code comment above, there are 101 SQL statements being executed! This is because each
time you access the <code>orders</code> relation property of a different <code>Customer</code> object in the for-loop, a SQL statement 
will be executed.</p>
<p>To solve this performance problem, you can use the so-called <em>eager loading</em> approach as shown below,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;LIMIT&nbsp;100;<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`orders`&nbsp;WHERE&nbsp;`customer_id`&nbsp;IN&nbsp;(...)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;no&nbsp;SQL&nbsp;executed<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br />}</span></code></pre>
<p>By calling <a href="yii-db-activequerytrait.html#with()-detail">yii\db\ActiveQuery::with()</a>, you instruct Active Record to bring back the orders for the first 100
customers in one single SQL statement. As a result, you reduce the number of the executed SQL statements from 101 to 2!</p>
<p>You can eagerly load one or multiple relations. You can even eagerly load <em>nested relations</em>. A nest relation is a relation
is declared within a related Active Record class. For example,  <code>Customer</code> is related with <code>Order</code> through the <code>orders</code>
relation, and <code>Order</code> is related with <code>Item</code> through the <code>items</code> relation. When querying for <code>Customer</code>, you can eagerly
load <code>items</code> using the nested relation notation <code>orders.items</code>. </p>
<p>The following code shows different usage of <a href="yii-db-activequerytrait.html#with()-detail">with()</a>. We assume the <code>Customer</code> class
has two relations <code>orders</code> and <code>country</code>, while the <code>Order</code> class has one relation <code>items</code>.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;eager&nbsp;loading&nbsp;both&nbsp;"orders"&nbsp;and&nbsp;"country"<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'country'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;array&nbsp;syntax&nbsp;below<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">([</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'country'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;no&nbsp;SQL&nbsp;executed&nbsp;<br /></span><span style="color: #0000BB">$orders</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;no&nbsp;SQL&nbsp;executed&nbsp;<br /></span><span style="color: #0000BB">$country&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">country</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;eager&nbsp;loading&nbsp;"orders"&nbsp;and&nbsp;the&nbsp;nested&nbsp;relation&nbsp;"orders.items"<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders.items'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;access&nbsp;the&nbsp;items&nbsp;of&nbsp;the&nbsp;first&nbsp;order&nbsp;of&nbsp;the&nbsp;first&nbsp;customer<br />//&nbsp;no&nbsp;SQL&nbsp;executed<br /></span><span style="color: #0000BB">$items&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customers</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]-&gt;</span><span style="color: #0000BB">items</span><span style="color: #007700">;</span></code></pre>
<p>You can eagerly load deeply nested relations, such as <code>a.b.c.d</code>. All parent relations will be eagerly loaded.
That is, when you call <a href="yii-db-activequerytrait.html#with()-detail">with()</a> using <code>a.b.c.d</code>, you will be eagerly load
<code>a</code>, <code>a.b</code>, <code>a.b.c</code> and <code>a.b.c.d</code>.  </p>
<blockquote><p>Info: In general, when eagerly loading <code>N</code> relations among which <code>M</code> relations are defined with a 
  <a href="#junction-table">junction table</a>, a total number of <code>N+M+1</code> SQL statements will be executed.
  Note that a nested relation <code>a.b.c.d</code> counts as 4 relations.</p>
</blockquote>
<p>When eagerly loading a relation, you can customize the corresponding relational query using an anonymous function.
For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;find&nbsp;customers&nbsp;and&nbsp;bring&nbsp;back&nbsp;together&nbsp;their&nbsp;country&nbsp;and&nbsp;active&nbsp;orders<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`country`&nbsp;WHERE&nbsp;`id`&nbsp;IN&nbsp;(...)<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;IN&nbsp;(...)&nbsp;AND&nbsp;`status`&nbsp;=&nbsp;1<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'country'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'orders'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;},<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>When customizing the relational query for a relation, you should specify the relation name as an array key
and use an anonymous function as the corresponding array value. The anonymous function will receive a <code>$query</code> parameter
which represents the <a href="yii-db-activequery.html">yii\db\ActiveQuery</a> object used to perform the relational query for the relation.
In the code example above, we are modifying the relational query by appending an additional condition about order status.</p>
<blockquote><p>Note: If you call <a href="yii-db-query.html#select()-detail">select()</a> while eagerly loading relations, you have to make sure
the columns referenced in the relation declarations are being selected. Otherwise, the related models may not 
be loaded properly. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'amount'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;$orders[0]-&gt;customer&nbsp;is&nbsp;always&nbsp;null.&nbsp;To&nbsp;fix&nbsp;the&nbsp;problem,&nbsp;you&nbsp;should&nbsp;do&nbsp;the&nbsp;following:<br /></span><span style="color: #0000BB">$orders&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">([</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'amount'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
</blockquote>
<h3>Joining with Relations <span id="joining-with-relations"></span> <a href="#joining-with-relations" id="joining-with-relations" class="hashlink">&para;</a></h3><blockquote><p>Note: The content described in this subsection is only applicable to relational databases, such as 
  MySQL, PostgreSQL, etc.</p>
</blockquote>
<p>The relational queries that we have described so far only reference the primary table columns when 
querying for the primary data. In reality we often need to reference columns in the related tables. For example,
we may want to bring back the customers who have at least one active order. To solve this problem, we can
build a join query like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;`customer`.*&nbsp;FROM&nbsp;`customer`<br />//&nbsp;LEFT&nbsp;JOIN&nbsp;`order`&nbsp;ON&nbsp;`order`.`customer_id`&nbsp;=&nbsp;`customer`.`id`<br />//&nbsp;WHERE&nbsp;`order`.`status`&nbsp;=&nbsp;1<br />//&nbsp;<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;IN&nbsp;(...)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer.*'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #DD0000">'order'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'`order`.`customer_id`&nbsp;=&nbsp;`customer`.`id`'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'order.status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<blockquote><p>Note: It is important to disambiguate column names when building relational queries involving JOIN SQL statements. 
  A common practice is to prefix column names with their corresponding table names.</p>
</blockquote>
<p>However, a better approach is to exploit the existing relation declarations by calling <a href="yii-db-activequery.html#joinWith()-detail">yii\db\ActiveQuery::joinWith()</a>:</p>
<pre><code class="language-php"><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">([</span><span style="color: #DD0000">'order.status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">])<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>Both approaches execute the same set of SQL statements. The latter approach is much cleaner and drier, though. </p>
<p>By default, <a href="yii-db-activequery.html#joinWith()-detail">joinWith()</a> will use <code>LEFT JOIN</code> to join the primary table with the 
related table. You can specify a different join type (e.g. <code>RIGHT JOIN</code>) via its third parameter <code>$joinType</code>. If
the join type you want is <code>INNER JOIN</code>, you can simply call <a href="yii-db-activequery.html#innerJoinWith()-detail">innerJoinWith()</a>, instead.</p>
<p>Calling <a href="yii-db-activequery.html#joinWith()-detail">joinWith()</a> will <a href="#lazy-eager-loading">eagerly load</a> the related data by default.
If you do not want to bring in the related data, you can specify its second parameter <code>$eagerLoading</code> as false. </p>
<p>Like <a href="yii-db-activequerytrait.html#with()-detail">with()</a>, you can join with one or multiple relations; you may customize the relation
queries on-the-fly; you may join with nested relations; and you may mix the use of <a href="yii-db-activequerytrait.html#with()-detail">with()</a>
and <a href="yii-db-activequery.html#joinWith()-detail">joinWith()</a>. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'orders'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'&gt;'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'subtotal'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;},<br />])-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'country'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>Sometimes when joining two tables, you may need to specify some extra conditions in the <code>ON</code> part of the JOIN query.
This can be done by calling the <a href="yii-db-activequery.html#onCondition()-detail">yii\db\ActiveQuery::onCondition()</a> method like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;`customer`.*&nbsp;FROM&nbsp;`customer`<br />//&nbsp;LEFT&nbsp;JOIN&nbsp;`order`&nbsp;ON&nbsp;`order`.`customer_id`&nbsp;=&nbsp;`customer`.`id`&nbsp;AND&nbsp;`order`.`status`&nbsp;=&nbsp;1&nbsp;<br />//&nbsp;<br />//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;IN&nbsp;(...)<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">joinWith</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'orders'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;(</span><span style="color: #0000BB">$query</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">onCondition</span><span style="color: #007700">([</span><span style="color: #DD0000">'order.status'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">STATUS_ACTIVE</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;},<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>This above query brings back <em>all</em> customers, and for each customer it brings back all active orders.
Note that this differs from our earlier example which only brings back customers who have at least one active orders.</p>
<blockquote><p>Info: When <a href="yii-db-activequery.html">yii\db\ActiveQuery</a> is specified with a condition via [[<a href="yii-db-activequery.html#onCondition()-detail">onCondition()</a>,
  the condition will be put in the <code>ON</code> part if the query involves a JOIN query. If the query does not involve
  JOIN, the on-condition will be automatically appended to the <code>WHERE</code> part of the query.</p>
</blockquote>
<h3>Inverse Relations <span id="inverse-relations"></span> <a href="#inverse-relations" id="inverse-relations" class="hashlink">&para;</a></h3><p>Relation declarations are often reciprocal between two Active Record classes. For example, <code>Customer</code> is related 
to <code>Order</code> via the <code>orders</code> relation, and <code>Order</code> is related back to <code>Customer</code> via the <code>customer</code> relation.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Order&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCustomer</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>Now consider the following piece of code:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">customer</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;displays&nbsp;"not&nbsp;the&nbsp;same"<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$customer2&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">'same'&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">'not&nbsp;the&nbsp;same'</span><span style="color: #007700">;</span></code></pre>
<p>We would think <code>$customer</code> and <code>$customer2</code> are the same, but they are not! Actually they do contain the same
customer data, but they are different objects. When accessing <code>$order-&gt;customer</code>, an extra SQL statement
is executed to populate a new object <code>$customer2</code>.</p>
<p>To avoid the redundant execution of the last SQL statement in the above example, we should tell Yii that
<code>customer</code> is an <em>inverse relation</em> of <code>orders</code> by calling the <a href="yii-db-activerelationtrait.html#inverseOf()-detail">inverseOf()</a> method
like shown below:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrders</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Order</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">inverseOf</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>With this modified relation declaration, we will have:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`customer`&nbsp;WHERE&nbsp;`id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;SELECT&nbsp;*&nbsp;FROM&nbsp;`order`&nbsp;WHERE&nbsp;`customer_id`&nbsp;=&nbsp;123<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//&nbsp;No&nbsp;SQL&nbsp;will&nbsp;be&nbsp;executed<br /></span><span style="color: #0000BB">$customer2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">customer</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;displays&nbsp;"same"<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$customer2&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">'same'&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">'not&nbsp;the&nbsp;same'</span><span style="color: #007700">;</span></code></pre>
<blockquote><p>Note: Inverse relations cannot be defined for relations involving a <a href="#junction-table">junction table</a>.
  That is, if a relation is defined with <a href="yii-db-activerelationtrait.html#via()-detail">via()</a> or <a href="yii-db-activequery.html#viaTable()-detail">viaTable()</a>,
  you should not call <a href="yii-db-activerelationtrait.html#inverseOf()-detail">inverseOf()</a> further.</p>
</blockquote>
<h2>Saving Relations <span id="saving-relations"></span> <a href="#saving-relations" id="saving-relations" class="hashlink">&para;</a></h2><p>When working with relational data, you often need to establish relationships between different data or destroy
existing relationships. This requires setting proper values for the columns that define the relations. Using Active Record,
you may end up writing the code like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">subtotal&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;...<br /><br />//&nbsp;setting&nbsp;the&nbsp;attribute&nbsp;that&nbsp;defines&nbsp;the&nbsp;"customer"&nbsp;relation&nbsp;in&nbsp;Order<br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">customer_id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();</span></code></pre>
<p>Active Record provides the <a href="yii-db-baseactiverecord.html#link()-detail">link()</a> method that allows you to accomplish this task more nicely:</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">(</span><span style="color: #0000BB">123</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Order</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">subtotal&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;...<br /><br /></span><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">(</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">);</span></code></pre>
<p>The <a href="yii-db-baseactiverecord.html#link()-detail">link()</a> method requires you to specify the relation name and the target Active Record
instance that the relationship should be established with. The method will modify the values of the attributes that
link two Active Record instances and save them to the database. In the above example, it will set the <code>customer_id</code>
attribute of the <code>Order</code> instance to be the value of the <code>id</code> attribute of the <code>Customer</code> instance and then save it
to the database.</p>
<blockquote><p>Note: You cannot link two newly created Active Record instances.</p>
</blockquote>
<p>The benefit of using <a href="yii-db-baseactiverecord.html#link()-detail">link()</a> is even more obvious when a relation is defined via
a <a href="#junction-table">junction table</a>. For example, you may use the following code to link an <code>Order</code> instance
with an <code>Item</code> instance:</p>
<pre><code class="language-php"><span style="color: #0000BB">$order</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">(</span><span style="color: #DD0000">'items'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$item</span><span style="color: #007700">);</span></code></pre>
<p>The above code will automatically insert a row in the <code>order_item</code> junction table to relate the order with the item.</p>
<blockquote><p>Info: The <a href="yii-db-baseactiverecord.html#link()-detail">link()</a> method will NOT perform any data validation while
  saving the affected Active Record instance. It is your responsibility to validate any input data before
  calling this method.</p>
</blockquote>
<p>The opposite operation to <a href="yii-db-baseactiverecord.html#link()-detail">link()</a> is <a href="yii-db-baseactiverecord.html#unlink()-detail">unlink()</a>
which breaks an existing relationship between two Active Record instances. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB">$customer&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unlink</span><span style="color: #007700">(</span><span style="color: #DD0000">'orders'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$customer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">orders</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]);</span></code></pre>
<p>By default, the <a href="yii-db-baseactiverecord.html#unlink()-detail">unlink()</a> method will set the foreign key value(s) that specify
the existing relationship to be null. You may, however, choose to delete the table row that contains the foreign key value
by passing the <code>$delete</code> parameter as true to the method.</p>
<p>When a junction table is involved in a relation, calling <a href="yii-db-baseactiverecord.html#unlink()-detail">unlink()</a> will cause
the foreign keys in the junction table to be cleared, or the deletion of the corresponding row in the junction table
if <code>$delete</code> is true.</p>
<h2>Cross-Database Relations <span id="cross-database-relations"></span> <a href="#cross-database-relations" id="cross-database-relations" class="hashlink">&para;</a></h2><p>Active Record allows you to declare relations between Active Record classes that are powered by different databases.
The databases can be of different types (e.g. MySQL and PostgreSQL, or MS SQL and MongoDB), and they can run on 
different servers. You can use the same syntax to perform relational queries. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;Customer&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;"customer"&nbsp;table&nbsp;in&nbsp;a&nbsp;relational&nbsp;database&nbsp;(e.g.&nbsp;MySQL)<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'customer'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getComments</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;a&nbsp;customer&nbsp;has&nbsp;many&nbsp;comments<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;"comment"&nbsp;collection&nbsp;in&nbsp;a&nbsp;MongoDB&nbsp;database<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Comment&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">mongodb</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">collectionName</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'comment'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getCustomer</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;a&nbsp;comment&nbsp;has&nbsp;one&nbsp;customer<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasOne</span><span style="color: #007700">(</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'customer_id'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'comments'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>You can use most of the relational query features that have been described in this section. </p>
<blockquote><p>Note: Usage of <a href="yii-db-activequery.html#joinWith()-detail">joinWith()</a> is limited to databases that allow cross-database JOIN queries.
  For this reason, you cannot use this method in the above example because MongoDB does not support JOIN.</p>
</blockquote>
<h2>Customizing Query Classes <span id="customizing-query-classes"></span> <a href="#customizing-query-classes" id="customizing-query-classes" class="hashlink">&para;</a></h2><p>By default, all Active Record queries are supported by <a href="yii-db-activequery.html">yii\db\ActiveQuery</a>. To use a customized query class
in an Active Record class, you should override the <a href="yii-db-activerecord.html#find()-detail">yii\db\ActiveRecord::find()</a> method and return an instance
of your customized query class. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">models</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveQuery</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">Comment&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">find</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">CommentQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">get_called_class</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">CommentQuery&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveQuery<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...<br /></span><span style="color: #007700">}</span></code></pre>
<p>Now whenever you are performing a query (e.g. <code>find()</code>, <code>findOne()</code>) or defining a relation (e.g. <code>hasOne()</code>) 
with <code>Comment</code>, you will be working with an instance of <code>CommentQuery</code> instead of <code>ActiveQuery</code>.</p>
<blockquote><p>Tip: In big projects, it is recommended that you use customized query classes to hold most query-related code
  so that the Active Record classes can be kept clean.</p>
</blockquote>
<p>You can customize a query class in many creative ways to improve your query building experience. For example,
you can define new query building methods in a customized query class: </p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">CommentQuery&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveQuery<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">active</span><span style="color: #007700">(</span><span style="color: #0000BB">$state&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">([</span><span style="color: #DD0000">'active'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$state</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<blockquote><p>Note: Instead of calling <a href="yii-db-querytrait.html#where()-detail">where()</a>, you usually should call
  <a href="yii-db-querytrait.html#andWhere()-detail">andWhere()</a> or <a href="yii-db-querytrait.html#orWhere()-detail">orWhere()</a> to append additional
  conditions when defining new query building methods so that any existing conditions are not overwritten.</p>
</blockquote>
<p>This allows you to write query building code like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB">$comments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$inactiveComments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<p>You can also use the new query building methods when defining relations about <code>Comment</code> or performing relational query:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Customer&nbsp;</span><span style="color: #007700">extends&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getActiveComments</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasMany</span><span style="color: #007700">(</span><span style="color: #0000BB">Comment</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),&nbsp;[</span><span style="color: #DD0000">'customer_id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(</span><span style="color: #DD0000">'activeComments'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;or&nbsp;alternatively<br />&nbsp;<br /></span><span style="color: #0000BB">$customers&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Customer</span><span style="color: #007700">::</span><span style="color: #0000BB">find</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'comments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function(</span><span style="color: #0000BB">$q</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$q</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">active</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />])-&gt;</span><span style="color: #0000BB">all</span><span style="color: #007700">();</span></code></pre>
<blockquote><p>Info: In Yii 1.1, there is a concept called <em>scope</em>. Scope is no longer directly supported in Yii 2.0,
  and you should use customized query classes and query methods to achieve the same goal.</p>
</blockquote>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Sat, 21 Mar 2015 22:11:26 +0000</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// focus the search field
searchBox.focus();

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['site._setAccount', 'UA-5843896-1']);
_gaq.push(['site._trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body>

<!-- Mirrored from www.yiiframework.com/doc-2.0/guide-db-active-record.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 27 May 2015 18:10:59 GMT -->
</html>
